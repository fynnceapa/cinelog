<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Profil {{ profile_user.username }} - CineLog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --bg-body: #14181c;
            --bg-card: #1f252d;
            --bg-input: #2c3440;
            --text-main: #ffffff;
            --text-secondary: #e1e3e6;
            --text-muted: #99aabb;
            --accent-color: #40bcf4;
            --border-color: #2c3b49;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
        }

        /* --- Navbar --- */
        .navbar {
            background-color: #242c36 !important;
            border-bottom: 1px solid #445566;
            padding: 1rem 0;
        }
        .navbar-brand { font-weight: 800; letter-spacing: 1px; color: #fff !important; }

        /* --- Profile Sidebar (Left) --- */
        .profile-sidebar {
            background-color: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 30px;
            text-align: center;
            /* Sticky effect: stays visible when scrolling reviews */
            position: sticky;
            top: 100px; 
        }

        .avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .avatar-img {
            width: 140px;
            height: 140px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid var(--bg-body);
            box-shadow: 0 0 0 3px var(--accent-color); /* Double border effect */
        }

        .username-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 5px;
            color: var(--text-main);
        }

        .join-date {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .stats-box {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            padding: 15px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .bio-section {
            text-align: left;
            margin-bottom: 20px;
        }
        
        .bio-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* --- Forms (Dark Theme) --- */
        .form-control-dark {
            background-color: var(--bg-input);
            border: 1px solid var(--border-color);
            color: #fff;
        }
        .form-control-dark:focus {
            background-color: #384250;
            border-color: var(--accent-color);
            color: #fff;
            box-shadow: 0 0 0 3px rgba(64, 188, 244, 0.25);
        }

        /* --- Review Feed (Right) --- */
        .section-header {
            color: var(--text-muted);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .review-card {
            background-color: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, background-color 0.2s;
        }

        .review-card:hover {
            transform: translateY(-3px);
            background-color: #262d36;
            border-color: var(--accent-color);
        }

        /* Review Layout: Poster Left, Content Right */
        .review-grid {
            display: flex;
            align-items: stretch;
        }

        .review-poster {
            width: 100px;
            flex-shrink: 0;
        }
        
        .review-poster img {
            width: 100%;
            height: 100%; /* Fortam inaltimea cardului */
            object-fit: cover;
            min-height: 150px;
        }

        .review-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .movie-link {
            text-decoration: none;
            color: var(--text-main);
            font-weight: 700;
            font-size: 1.2rem;
        }
        .movie-link:hover { color: var(--accent-color); }

        .star-rating { color: #ffc107; font-size: 0.9rem; }

        .review-text {
            color: var(--text-secondary);
            margin-top: 10px;
            font-size: 0.95rem;
            line-height: 1.5;
            flex-grow: 1;
        }

        .review-footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #678;
            font-size: 0.8rem;
        }

        /* Buttons */
        .btn-outline-accent {
            color: var(--accent-color);
            border-color: var(--accent-color);
            font-weight: 600;
        }
        .btn-outline-accent:hover {
            background-color: var(--accent-color);
            color: #000;
        }
        
        .btn-save {
            background-color: var(--accent-color);
            color: #000;
            font-weight: 700;
            border: none;
        }
        .btn-save:hover { background-color: #7ad7ff; color: #000; }

        @media (max-width: 768px) {
            .profile-sidebar { position: static; margin-bottom: 30px; }
            .review-grid { flex-direction: column; }
            .review-poster { width: 100%; height: 150px; }
            .review-poster img { object-position: center 20%; }
        }

        footer {
            background-color: #242c36;
            color: #b0c0d0; /* Footer mai lizibil */
            border-top: 1px solid #456;
            margin-top: 60px auto 0;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark sticky-top mb-5">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">
                <span class="fs-5 me-2">⬅</span> CineLog
            </a>
            {% if user.is_authenticated and not is_own_profile %}
                 <span class="text-white small">Esti pe profilul lui {{ profile_user.username }}</span>
            {% endif %}
        </div>
    </nav>

    <div class="container pb-5">
        <div class="row">
            
            <div class="col-lg-4">
                <div class="profile-sidebar shadow-lg">
                    <div class="avatar-container">
                        {% if profile_user.profile.avatar_url %}
                            <img src="{{ profile_user.profile.avatar_url }}" class="avatar-img" alt="Avatar">
                        {% else %}
                            <img src="https://ui-avatars.com/api/?name={{ profile_user.username }}&background=2c3440&color=40bcf4&size=150" class="avatar-img" alt="Default Avatar">
                        {% endif %}
                    </div>
                    
                    <h1 class="username-title">{{ profile_user.username }}</h1>
                    <p class="join-date">Membru din {{ profile_user.date_joined|date:"M Y" }}</p>
                    
                    <div class="stats-box">
                        <div>
                            <div class="stat-number">{{ reviews.count }}</div>
                            <div class="stat-label">Recenzii</div>
                        </div>
                    </div>
                    
                    <div class="bio-section">
                        <small class="text-muted text-uppercase fw-bold mb-2 d-block">Despre</small>
                        <div class="bio-text">
                            {% if profile_user.profile.bio %}
                                {{ profile_user.profile.bio|linebreaks }}
                            {% else %}
                                <em class="text-muted">Acest utilizator nu a adaugat descriere.</em>
                            {% endif %}
                        </div>
                    </div>

                    {% if is_own_profile %}
                        <button class="btn btn-outline-accent w-100 mt-3" type="button" data-bs-toggle="collapse" data-bs-target="#editForm">
                            <i class="bi bi-gear-fill"></i> Editeaza
                        </button>
                        
                        <div class="collapse mt-3 text-start" id="editForm">
                            <div class="card card-body bg-dark border-secondary p-3">
                                <form method="post">
                                    {% csrf_token %}
                                    <div class="mb-3">
                                        <label class="form-label text-white small fw-bold">URL Avatar</label>
                                        <input type="url" name="avatar_url" class="form-control form-control-dark form-control-sm" value="{{ profile_user.profile.avatar_url }}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label text-white small fw-bold">Biografie</label>
                                        <textarea name="bio" class="form-control form-control-dark form-control-sm" rows="3">{{ profile_user.profile.bio }}</textarea>
                                    </div>
                                    <button type="submit" class="btn btn-save btn-sm w-100">Salvează Modificări</button>
                                </form>
                            </div>
                        </div>
                    
                    {% elif user.is_authenticated %}
                        <a href="{% url 'toggle_follow' profile_user.id %}" 
                           class="btn {% if is_following %}btn-outline-danger{% else %}btn-save{% endif %} w-100 mt-3">
                            {% if is_following %}
                                <i class="bi bi-person-dash-fill"></i> Unfollow
                            {% else %}
                                <i class="bi bi-person-plus-fill"></i> Follow
                            {% endif %}
                        </a>
                    {% endif %}

                </div>
            </div>

            <div class="col-lg-8">
                {% if watchlist %}
                    <h4 class="section-header mb-3">
                        <i class="bi bi-bookmark-heart text-info me-2"></i> Watchlist
                    </h4>
                    
                    <div class="row row-cols-3 row-cols-md-4 row-cols-lg-5 g-3 mb-5">
                        {% for movie in watchlist %}
                        <div class="col">
                            <a href="{% url 'movie_detail' movie.id %}" class="text-decoration-none">
                                <div class="card bg-transparent border-0 h-100">
                                    <div class="position-relative rounded overflow-hidden border border-secondary" style="aspect-ratio: 2/3;">
                                        {% if movie.poster_url %}
                                            <img src="{{ movie.poster_url }}" class="w-100 h-100 object-fit-cover" alt="{{ movie.title }}">
                                        {% else %}
                                            <div class="d-flex align-items-center justify-content-center bg-secondary w-100 h-100 text-white">
                                                <i class="bi bi-film"></i>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-dark bg-opacity-75 opacity-0 hover-opacity-100 transition-opacity" style="transition: opacity 0.2s;">
                                            <span class="badge bg-info text-dark">Vezi</span>
                                        </div>
                                    </div>
                                    <div class="mt-2 text-center">
                                        <small class="text-white text-truncate d-block fw-bold" title="{{ movie.title }}">{{ movie.title }}</small>
                                    </div>
                                </div>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                {% elif is_own_profile %}
                    <div class="alert alert-dark border-secondary mb-5 d-flex align-items-center" role="alert">
                        <i class="bi bi-info-circle me-3 fs-4 text-info"></i>
                        <div>
                            <strong>Lista ta este goală.</strong><br>
                            Mergi la filme și apasă pe "Adaugă în Listă" pentru a salva ce vrei să vezi.
                        </div>
                    </div>
                {% endif %}
                <h4 class="section-header">Review-uri</h4>

                {% for review in reviews %}
                    <div class="review-card mb-4">
                        <div class="review-grid">
                            <a href="{% url 'movie_detail' review.movie.id %}" class="review-poster">
                                {% if review.movie.poster_url %}
                                    <img src="{{ review.movie.poster_url }}" alt="{{ review.movie.title }}">
                                {% else %}
                                    <img src="https://via.placeholder.com/150x225?text=No+Img" alt="No Poster">
                                {% endif %}
                            </a>

                            <div class="review-content">
                                <div class="d-flex justify-content-between align-items-start">
                                    <a href="{% url 'movie_detail' review.movie.id %}" class="movie-link">
                                        {{ review.movie.title }}
                                        <small class="text-muted fw-normal ms-1 fs-6">({{ review.movie.release_date|date:"Y" }})</small>
                                    </a>
                                    <span class="star-rating">
                                        {% for i in "12345"|make_list %}
                                            {% if forloop.counter <= review.rating %}★{% else %}<span style="color: #445566;">★</span>{% endif %}
                                        {% endfor %}
                                    </span>
                                </div>

                                <div class="review-text">
                                    {{ review.content|truncatewords:50 }}
                                </div>

                                <div class="review-footer d-flex justify-content-between">
                                    <span>Văzut pe {{ review.created_at|date:"d M Y" }}</span>
                                    {% if review.rating == 5 %}
                                        <span style="color: #ff6b6b;"><i class="bi bi-heart-fill"></i> Favorit</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>  
                    </div>
                {% empty %}
                    <div class="text-center py-5 border border-secondary border-opacity-25 rounded bg-dark">
                        <span class="display-1 d-block mb-3"><i class="bi bi-inbox-fill display-1"></i></span>
                        <p class="text-white fs-5">Nu există activitate.</p>
                        <p class="text-muted">Utilizatorul nu a scris nicio recenzie inca.</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <footer class="text-center py-4 mt-auto">
        <div class="container">
            <small style="color: #8899aa;">&copy; 2025 CineLog - Proiect Sisteme Distribuite</small>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>